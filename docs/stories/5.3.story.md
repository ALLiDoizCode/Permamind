# Story 5.3: Integrate Process Management Tools with Existing Infrastructure

## Status

Pending

## Story

**As a** Permamind user,
**I want** the new process management tools to work seamlessly with existing functionality,
**so that** I can combine process creation/evaluation with memory storage, documentation queries, and workflow execution.

## Acceptance Criteria

1. Register new tools in ProcessToolFactory alongside existing process tools
2. Ensure compatibility with current executeAction and queryAOProcessMessages functionality
3. Maintain existing MCP server registration patterns in server.ts
4. Preserve all current process communication capabilities
5. Support process lifecycle: create → evaluate → communicate → query
6. Enable process management within BMAD workflow contexts
7. Update tool documentation to reflect expanded process management capabilities

## Tasks / Subtasks

- [ ] **Register new tools in ProcessToolFactory** (AC: 1)
  - [ ] Add CreateProcessCommand and EvalProcessCommand to ProcessToolFactory registration
  - [ ] Update getToolClasses() method to include both new commands
  - [ ] Ensure proper import statements for new command classes
  - [ ] Verify tool factory follows existing BaseToolFactory patterns
  - [ ] Test tool factory registration with FastMCP framework

- [ ] **Verify compatibility with existing process tools** (AC: 2)
  - [ ] Test CreateProcessCommand integration with ExecuteProcessActionCommand
  - [ ] Verify EvalProcessCommand works with QueryAOProcessMessagesCommand
  - [ ] Ensure new tools don't conflict with existing process communication patterns
  - [ ] Validate that process creation followed by action execution works seamlessly
  - [ ] Test evaluation results can be queried through existing message query tools

- [ ] **Maintain MCP server registration patterns** (AC: 3)
  - [ ] Update ProcessToolFactory registration in server.ts if needed
  - [ ] Ensure new tools appear in MCP tool registry correctly
  - [ ] Verify tool metadata is properly exposed to MCP clients
  - [ ] Test tool discovery and invocation through MCP protocol
  - [ ] Maintain consistency with existing tool registration approach

- [ ] **Preserve current process communication capabilities** (AC: 4)
  - [ ] Verify ExecuteProcessActionCommand functionality remains intact
  - [ ] Ensure QueryAOProcessMessagesCommand continues to work correctly
  - [ ] Test existing process communication workflows are not affected
  - [ ] Validate that process messaging patterns remain functional
  - [ ] Confirm AO Connect integration patterns are preserved

- [ ] **Implement complete process lifecycle support** (AC: 5)
  - [ ] Test create → evaluate workflow: CreateProcessCommand followed by EvalProcessCommand
  - [ ] Test create → communicate workflow: CreateProcessCommand followed by ExecuteProcessActionCommand
  - [ ] Test evaluate → query workflow: EvalProcessCommand followed by QueryAOProcessMessagesCommand
  - [ ] Verify complete lifecycle: create → evaluate → communicate → query
  - [ ] Ensure process state consistency throughout lifecycle operations

- [ ] **Enable BMAD workflow integration** (AC: 6)
  - [ ] Test process management tools within BMAD task execution contexts
  - [ ] Verify compatibility with existing BMAD workflow automation
  - [ ] Ensure process creation/evaluation can be automated through BMAD templates
  - [ ] Test integration with BMAD agent personas and workflow coordination
  - [ ] Validate process management enhances BMAD development capabilities

- [ ] **Update documentation and tool descriptions** (AC: 7)
  - [ ] Update ProcessToolFactory documentation to include new capabilities
  - [ ] Create usage examples showing process management workflows
  - [ ] Document integration patterns with existing tools
  - [ ] Update MCP tool descriptions to reflect expanded process management
  - [ ] Provide workflow examples combining all process tools

- [ ] **Integration testing for process management workflows**
  - [ ] Create integration tests for complete process lifecycle workflows
  - [ ] Test process creation followed by code evaluation and communication
  - [ ] Verify error handling across tool interactions
  - [ ] Test concurrent process management operations
  - [ ] Validate process state consistency across tool interactions

- [ ] **Regression testing for existing functionality**
  - [ ] Run full test suite to ensure no regression in existing process tools
  - [ ] Test memory storage integration with process management
  - [ ] Verify token tools continue to work with new process capabilities
  - [ ] Test documentation tools integration remains functional
  - [ ] Ensure BMAD integration remains stable with expanded process tools

## Dev Notes

### Previous Story Insights

From Story 5.1 (CreateProcess MCP Tool) and Story 5.2 (EvalProcess MCP Tool):

- ProcessToolFactory integration patterns established for both tools
- Tool registration and MCP integration patterns confirmed
- Error handling and response format consistency achieved
- AO Connect integration maintained compatibility
- Signer management and tool context patterns unified

### Integration Requirements

**Process Management Workflow Integration** [Source: Epic 5 requirements]:

The complete AO process lifecycle should support:

1. **Process Creation**: CreateProcessCommand spawns new AO process
2. **Code Evaluation**: EvalProcessCommand tests functionality and setup
3. **Process Communication**: ExecuteProcessActionCommand handles ongoing operations
4. **Message Querying**: QueryAOProcessMessagesCommand monitors process activity

**BMAD Workflow Integration** [Source: Epic 2 BMAD integration]:

- Process management tools should integrate with BMAD task execution
- Support AO development workflows within BMAD methodology
- Enable automated process creation and testing through BMAD templates
- Provide foundation for complete AO development lifecycle management

### Data Models

**Process Lifecycle Workflow State** [Source: Integration requirements]:

```typescript
interface ProcessLifecycleState {
  processId: string;
  creationResult: CreateProcessResponse;
  evaluationResults: EvalProcessResponse[];
  communicationHistory: ProcessActionResponse[];
  messageQuery: ProcessMessagesResponse;
}
```

**Tool Integration Context** [Source: ProcessToolFactory patterns]:

```typescript
interface ProcessToolIntegrationContext {
  createProcess: CreateProcessCommand;
  evalProcess: EvalProcessCommand;
  executeAction: ExecuteProcessActionCommand;
  queryMessages: QueryAOProcessMessagesCommand;
}
```

### API Specifications

**ProcessToolFactory Registration Pattern** [Source: Existing tool factory patterns]:

```typescript
export class ProcessToolFactory extends BaseToolFactory {
  protected getToolClasses(): Array<new (context: ToolContext) => ToolCommand> {
    return [
      ExecuteProcessActionCommand,
      QueryAOProcessMessagesCommand,
      CreateProcessCommand, // New tool
      EvalProcessCommand, // New tool
    ];
  }
}
```

**Complete Process Lifecycle API** [Source: Integration design]:

```typescript
// 1. Create process
const createResult = await createProcessTool.execute({});
const processId = JSON.parse(createResult).processId;

// 2. Evaluate initial code
const evalResult = await evalProcessTool.execute({
  processId,
  code: "return 'Process initialized'",
});

// 3. Execute process actions
const actionResult = await executeActionTool.execute({
  processId,
  action: "Custom action",
  // other parameters
});

// 4. Query process messages
const messagesResult = await queryMessagesTool.execute({
  processId,
  // query parameters
});
```

### Component Specifications

**ProcessToolFactory Integration** [Source: Tool factory patterns]:

```typescript
export class ProcessToolFactory extends BaseToolFactory {
  constructor() {
    super(
      "Process Management Tools",
      "Tools for AO process lifecycle management",
    );
  }

  protected getToolClasses(): Array<new (context: ToolContext) => ToolCommand> {
    return [
      // Existing tools
      ExecuteProcessActionCommand,
      QueryAOProcessMessagesCommand,
      // New process management tools
      CreateProcessCommand,
      EvalProcessCommand,
    ];
  }
}
```

**Integration Test Structure** [Source: Testing requirements]:

```typescript
describe("Process Management Integration", () => {
  describe("Complete Process Lifecycle", () => {
    it("should support create → evaluate → communicate → query workflow", async () => {
      // Test complete workflow integration
    });
  });

  describe("BMAD Workflow Integration", () => {
    it("should integrate with BMAD task execution", async () => {
      // Test BMAD integration patterns
    });
  });

  describe("Existing Tool Compatibility", () => {
    it("should preserve all existing process tool functionality", async () => {
      // Test no regression in existing tools
    });
  });
});
```

### File Locations

**Files to Modify**:

- Tool Factory: `src/tools/process/ProcessToolFactory.ts` (add new tool registrations)
- Command Exports: `src/tools/process/commands/index.ts` (export new commands)
- Server Registration: `src/server.ts` (verify ProcessToolFactory registration)

**Files to Test**:

- Integration Tests: `tests/integration/process/ProcessManagementWorkflow.integration.test.ts`
- Tool Factory Tests: `tests/unit/tools/process/ProcessToolFactory.unit.test.ts`
- Regression Tests: Verify all existing process tool tests continue to pass

**Reference Files**:

- Existing Factory: `src/tools/process/ProcessToolFactory.ts`
- Server Registration: `src/server.ts` (ProcessToolFactory registration patterns)
- Integration Patterns: Other tool factory integration examples

### Testing Requirements

**Testing Framework**: Vitest with TypeScript support
**Test Locations**: `tests/unit/tools/process/` and `tests/integration/process/`
**Coverage Target**: 90% test coverage for integration scenarios
**Test Strategy**: Integration testing with mocked AO dependencies

**Integration Test Scenarios Required**:

- Complete process lifecycle workflow testing
- Tool interaction and state consistency validation
- BMAD workflow integration testing
- Regression testing for existing process tools
- Concurrent process management operation testing
- Error handling across tool interactions

### Technical Constraints

**Integration Requirements**:

- Must maintain compatibility with all existing process tools
- Must preserve current AO Connect integration patterns
- Must follow established MCP tool registration conventions
- Must maintain consistency with existing error handling patterns
- Must integrate seamlessly with BMAD workflow system

**Architecture Requirements**:

- Must extend ProcessToolFactory without breaking existing patterns
- Must maintain tool context and signer management consistency
- Must preserve existing process communication infrastructure
- Must follow established testing patterns for tool integration
- Must maintain compatibility with FastMCP framework

### Project Structure Notes

**Current Structure Assessment**:

- ProcessToolFactory provides established foundation for tool integration
- Existing process tools demonstrate proper integration patterns
- MCP server registration patterns support expanded tool sets
- Testing infrastructure supports both unit and integration testing
- BMAD integration patterns support process management tool inclusion

**Integration Alignment**:

- Tool factory patterns support seamless addition of new process tools
- Existing AO Connect integration provides foundation for expanded capabilities
- Current error handling patterns ensure consistency across all tools
- Testing infrastructure supports comprehensive integration validation
- BMAD workflow system can accommodate process management capabilities

**No Integration Conflicts Expected**:

- New tools extend existing patterns without modification
- Tool registration follows established MCP conventions
- Process communication infrastructure supports expanded tool set
- Error handling maintains consistency with existing patterns
- Testing patterns support both individual and integrated tool validation

## Testing

### Testing Standards

**Test Framework**: Vitest with TypeScript support
**Test Locations**: `tests/unit/tools/process/` and `tests/integration/process/`
**Coverage Target**: 90% test coverage for integration functionality
**Test Pattern**: Integration testing with workflow validation

### Test Cases Required

**Process Management Integration Tests**:

- Complete process lifecycle workflow (create → evaluate → communicate → query)
- Tool interaction state consistency validation
- Error handling across multiple tool interactions
- Concurrent process management operations
- BMAD workflow integration scenarios

**Regression Tests**:

- All existing process tool functionality preservation
- Memory storage integration compatibility
- Token tools integration with expanded process capabilities
- Documentation tools integration stability
- BMAD integration stability with expanded process tools

**Tool Factory Registration Tests**:

- ProcessToolFactory registration includes all tools correctly
- MCP server tool discovery and metadata exposure
- Tool context injection and signer management
- FastMCP framework integration validation

## Change Log

| Date       | Version | Description                                               | Author |
| ---------- | ------- | --------------------------------------------------------- | ------ |
| 2025-07-19 | 1.0     | Initial story creation for process management integration | Claude |

## Dev Agent Record

### Agent Model Used

_This section will be populated during development_

### Debug Log References

_To be filled during implementation_

### Completion Notes List

_To be filled during implementation_

### File List

**Files to Create:**

_To be populated during development_

**Files to Modify:**

_To be populated during development_

## QA Results

### Review Date

_To be filled during QA review_

### Reviewed By

_To be filled during QA review_

### Code Quality Assessment

_To be filled during QA review_

### Final Status

_To be determined during QA review_
